<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: ResolverUtils
  
    &mdash; XML Resolution Service
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (R)</a> &raquo; 
    
    
    <span class="title">ResolverUtils</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: ResolverUtils
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>ResolverUtils provides a service class of useful methods for the
XmlResolution service.</p>


  </div>
</div>
<div class="tags">
  
</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="LOCK_TIMEOUT-constant" class="">LOCK_TIMEOUT =
          <div class="docstring">
  <div class="discussion">
    
<p>Timeout in seconds for the read_lock and write_lock methods.</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='integer val'>10</span>
</pre></dd>
      
    </dl>
  





  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_directory-class_method" title="check_directory (class method)">+ (Object) <strong>check_directory</strong>(phrase, directory) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>check_directory PHRASE, DIRECTORY.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collection_name_ok%3F-class_method" title="collection_name_ok? (class method)">+ (Boolean) <strong>collection_name_ok?</strong>(collection_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>collection_name_ok? COLLECTION_ID.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#escape-class_method" title="escape (class method)">+ (Object) <strong>escape</strong>(*list) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>escape *LIST.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#group-class_method" title="group (class method)">+ (Object) <strong>group</strong>(pathname = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>group [ PATHNAME ].</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_lock-class_method" title="read_lock (class method)">+ (Object) <strong>read_lock</strong>(filepath, wait_time = LOCK_TIMEOUT) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>read_lock FILEPATH [ WAIT_TIME = LOCK_TIMEOUT ].</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remote_name-class_method" title="remote_name (class method)">+ (Object) <strong>remote_name</strong>(addr) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>remote_name ADDR.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unescape-class_method" title="unescape (class method)">+ (Object) <strong>unescape</strong>(string) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>unescape STRING .</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#user-class_method" title="user (class method)">+ (Object) <strong>user</strong>(pathname = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>user [ PATHNAME ].</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_lock-class_method" title="write_lock (class method)">+ (Object) <strong>write_lock</strong>(filepath, wait_time = LOCK_TIMEOUT) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>write_lock FILEPATH [ WAIT_TIME = LOCK_TIMEOUT ].</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="check_directory-class_method">
  
    + (<tt>Object</tt>) <strong>check_directory</strong>(phrase, directory) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>check_directory PHRASE, DIRECTORY</p>

<p>Carefully check that the directory named by the string DIRECTORY is
writable, and if not, throw an XmlResolution::ConfigurationError with a
descriptive message preceded by PHRASE.</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 50</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='check_directory identifier id'>check_directory</span> <span class='phrase identifier id'>phrase</span><span class='comma token'>,</span> <span class='directory identifier id'>directory</span>

  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span> <span class='directory identifier id'>directory</span>
    <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{phrase}, '#{directory}', doesn't exist or is unreadable by this user (#{ResolverUtils.user}) and group (#{ResolverUtils.group}).&quot;</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span> <span class='directory identifier id'>directory</span>
    <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{phrase}, '#{directory}', isn't a directory.&quot;</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='readable? fid id'>readable?</span> <span class='directory identifier id'>directory</span>
    <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{phrase}, '#{directory}', isn't readable by this user (#{ResolverUtils.user}) or group (#{ResolverUtils.group}).&quot;</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='writable? fid id'>writable?</span> <span class='directory identifier id'>directory</span>
    <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{phrase}, '#{directory}', isn't writable by this user (#{ResolverUtils.user}) or group (#{ResolverUtils.group}).&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="collection_name_ok?-class_method">
  
    + (<tt>Boolean</tt>) <strong>collection_name_ok?</strong>(collection_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>collection_name_ok? COLLECTION_ID</p>

<p>A boolean to determine if the string COLLECTION_ID is a valid collection
id. It has to fit into the filesystem as a directory, and must be able to
server as a single path component.</p>

<p>Note that the top-level routes can and should be more restrictive about
collection names - for instance, a UUID or IEID.</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 140</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='collection_name_ok? fid id'>collection_name_ok?</span> <span class='collection_id identifier id'>collection_id</span>
  <span class='not not kw'>not</span> <span class='lparen token'>(</span><span class='collection_id identifier id'>collection_id</span> <span class='match op'>=~</span> <span class='regexp val'>/\//</span> <span class='or or kw'>or</span> <span class='collection_id identifier id'>collection_id</span> <span class='neq op'>!=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='collection_id identifier id'>collection_id</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="escape-class_method">
  
    + (<tt>Object</tt>) <strong>escape</strong>(*list) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>escape *LIST</p>

<p>Given the arugment list LIST of strings, first URI escape them, then join
them with a space and return the constructed string.</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 118</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span> <span class='mult op'>*</span><span class='list identifier id'>list</span>
  <span class='list identifier id'>list</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='elt identifier id'>elt</span><span class='bitor op'>|</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='elt identifier id'>elt</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="group-class_method">
  
    + (<tt>Object</tt>) <strong>group</strong>(pathname = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>group [ PATHNAME ]</p>

<p>Without argument, return the group name (a string) of the user running this
process.  With argument PATHNAME (a string) naming an existing readable
file, return its group name.</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 35</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='group identifier id'>group</span> <span class='pathname identifier id'>pathname</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='if if kw'>if</span> <span class='pathname identifier id'>pathname</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='Etc constant id'>Etc</span><span class='dot token'>.</span><span class='getgrgid identifier id'>getgrgid</span><span class='lparen token'>(</span><span class='Process constant id'>Process</span><span class='dot token'>.</span><span class='gid identifier id'>gid</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='name identifier id'>name</span>
  <span class='else else kw'>else</span>
    <span class='Etc constant id'>Etc</span><span class='dot token'>.</span><span class='getgrgid identifier id'>getgrgid</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='stat identifier id'>stat</span><span class='lparen token'>(</span><span class='pathname identifier id'>pathname</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='gid identifier id'>gid</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='name identifier id'>name</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="read_lock-class_method">
  
    + (<tt>Object</tt>) <strong>read_lock</strong>(filepath, wait_time = LOCK_TIMEOUT) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>read_lock FILEPATH [ WAIT_TIME = LOCK_TIMEOUT ]</p>

<p>Access the file named by FILEPATH in a shared manner.  Note that we have
two kinds of locks associated with a given file, read_locks and
write_locks.  There may be 0, 1 or many locks active at any time. There may
exist many active read_locks at once, but if there is an active write_lock,
it is the only lock of any kind in existance (for FILEPATH) at that time. 
Requests for locks may block for up to WAIT_TIME seconds (defaults to
LOCK_TIMEOUT), after which a LockError exception is raised.</p>

<p>On success, we yield a file desciptor positioned at the beginning of the
file and ready to read from.  On exiting the block, the file is properly
closed and the lock released.</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="XmlResolution/LockError.html" title="XmlResolution::LockError (class)">XmlResolution::LockError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 104</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='read_lock identifier id'>read_lock</span> <span class='filepath identifier id'>filepath</span><span class='comma token'>,</span> <span class='wait_time identifier id'>wait_time</span> <span class='assign token'>=</span> <span class='LOCK_TIMEOUT constant id'>LOCK_TIMEOUT</span>
  <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='filepath identifier id'>filepath</span><span class='comma token'>,</span> <span class='string val'>'r'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fd identifier id'>fd</span><span class='bitor op'>|</span>
    <span class='Timeout constant id'>Timeout</span><span class='dot token'>.</span><span class='timeout identifier id'>timeout</span><span class='lparen token'>(</span><span class='wait_time identifier id'>wait_time</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='flock identifier id'>flock</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='LOCK_SH constant id'>LOCK_SH</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='yield yield kw'>yield</span> <span class='fd identifier id'>fd</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='LockError constant id'>LockError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Timed out waiting #{wait_time} seconds for read lock to #{filepath}: #{e.message}&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="remote_name-class_method">
  
    + (<tt>Object</tt>) <strong>remote_name</strong>(addr) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>remote_name ADDR</p>

<p>Attempts a reverse lookup on IP address ADDR; if it fails, just returns the
original address ADDR.</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


149
150
151
152
153
154</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 149</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='remote_name identifier id'>remote_name</span> <span class='addr identifier id'>addr</span>
  <span class='return return kw'>return</span> <span class='addr identifier id'>addr</span> <span class='if if_mod kw'>if</span> <span class='addr identifier id'>addr</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='addr identifier id'>addr</span> <span class='nmatch op'>!~</span> <span class='regexp val'>/^(\d+\.){3}\d+$/</span>
  <span class='Socket constant id'>Socket</span><span class='dot token'>.</span><span class='gethostbyaddr identifier id'>gethostbyaddr</span><span class='lparen token'>(</span><span class='addr identifier id'>addr</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>'.'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='octet identifier id'>octet</span><span class='bitor op'>|</span> <span class='octet identifier id'>octet</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>'CCCC'</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
<span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='addr identifier id'>addr</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="unescape-class_method">
  
    + (<tt>Object</tt>) <strong>unescape</strong>(string) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>unescape STRING</p>

<p>Perform the inverse of the escape method.</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 126</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='unescape identifier id'>unescape</span> <span class='string identifier id'>string</span>
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='string identifier id'>string</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\s+/</span><span class='rparen token'>)</span>
  <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='elt identifier id'>elt</span><span class='bitor op'>|</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='unescape identifier id'>unescape</span><span class='lparen token'>(</span><span class='elt identifier id'>elt</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="user-class_method">
  
    + (<tt>Object</tt>) <strong>user</strong>(pathname = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>user [ PATHNAME ]</p>

<p>Without argument, return the name (a string) of the user running this
process.  With argument PATHNAME (a string) naming an existing, readable
file, return the name of the user who owns it.</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 21</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='user identifier id'>user</span> <span class='pathname identifier id'>pathname</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='if if kw'>if</span> <span class='pathname identifier id'>pathname</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='Etc constant id'>Etc</span><span class='dot token'>.</span><span class='getpwuid identifier id'>getpwuid</span><span class='lparen token'>(</span><span class='Process constant id'>Process</span><span class='dot token'>.</span><span class='uid identifier id'>uid</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='name identifier id'>name</span>
  <span class='else else kw'>else</span>
    <span class='Etc constant id'>Etc</span><span class='dot token'>.</span><span class='getpwuid identifier id'>getpwuid</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='stat identifier id'>stat</span><span class='lparen token'>(</span><span class='pathname identifier id'>pathname</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='uid identifier id'>uid</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='name identifier id'>name</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="write_lock-class_method">
  
    + (<tt>Object</tt>) <strong>write_lock</strong>(filepath, wait_time = LOCK_TIMEOUT) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>write_lock FILEPATH [ WAIT_TIME = LOCK_TIMEOUT ]</p>

<p>Access the file named by FILEPATH exclusively. FILEPATH does not have to
exist. Times out after LOCK_TIMEOUT (or the optional WAIT_TIME, if
specified) seconds, raising a LockError exception. On successfully
obtaining a lock we truncate the file, and yield a file descriptor ready
for writing.  On exiting the block the file is properly closed and the lock
released. See the description of read_lock for more details on how these
kinds of lock work.</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="XmlResolution/LockError.html" title="XmlResolution::LockError (class)">XmlResolution::LockError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/utils.rb', line 79</span>

<span class='def def kw'>def</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='write_lock identifier id'>write_lock</span> <span class='filepath identifier id'>filepath</span><span class='comma token'>,</span> <span class='wait_time identifier id'>wait_time</span> <span class='assign token'>=</span> <span class='LOCK_TIMEOUT constant id'>LOCK_TIMEOUT</span>
  <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='filepath identifier id'>filepath</span><span class='comma token'>,</span> <span class='string val'>'a+'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fd identifier id'>fd</span><span class='bitor op'>|</span>                                <span class='comment val'># 'a+' followed by truncate in body; with just 'w' in</span>
    <span class='Timeout constant id'>Timeout</span><span class='dot token'>.</span><span class='timeout identifier id'>timeout</span><span class='lparen token'>(</span><span class='wait_time identifier id'>wait_time</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='flock identifier id'>flock</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='LOCK_EX constant id'>LOCK_EX</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>    <span class='comment val'>#  open we truncate w/o getting a lock!</span>
    <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='truncate identifier id'>truncate</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='yield yield kw'>yield</span> <span class='fd identifier id'>fd</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='LockError constant id'>LockError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Timed out waiting #{wait_time} seconds for write lock to #{filepath}: #{e.message}&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Fri Aug 19 15:43:28 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.8.7).
</div>

  </body>
</html>