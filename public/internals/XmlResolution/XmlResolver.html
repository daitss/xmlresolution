<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: XmlResolution::XmlResolver</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (X)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../XmlResolution.html" title="XmlResolution (module)">XmlResolution</a></span></span>
     &raquo; 
    <span class="title">XmlResolver</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: XmlResolution::XmlResolver
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">XmlResolution::XmlResolver</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Initial Author: Randy Fischer (rf@ufl.edu) for DAITSS
</p>
<p>
This class analyzes an XML document, attempting to recursively retrieve all
of the schema documents required to correctly validate it. It will
optionally use an HTTP caching proxy such as squid to fetch the schemas.  A
list of namespaces that were not able to be resolved can be retrieved using
the unresolved_namespaces method.
</p>
<p>
Example usage:
</p>
<pre class="code">
 <span class='xrez identifier id'>xrez</span> <span class='assign token'>=</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='XmlResolver constant id'>XmlResolver</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='string val'>&quot;F20060215_AAAAHL.xml&quot;</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;file://mydoc.xml&quot;</span><span class='comma token'>,</span>
                                       <span class='string val'>&quot;/var/resolver-files/&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;satyagraha.sacred.net:3128&quot;</span><span class='rparen token'>)</span>
  <span class='xrez identifier id'>xrez</span><span class='dot token'>.</span><span class='schema_dictionary identifier id'>schema_dictionary</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span>
     <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='retrieval_status identifier id'>retrieval_status</span> <span class='eq op'>==</span> <span class='symbol val'>:success</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;#{rec.namespace} =&gt; #{rec.location}\n&quot;</span>
  <span class='end end kw'>end</span>
  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;\nUnresolved: &quot;</span> <span class='plus op'>+</span> <span class='xrez identifier id'>xrez</span><span class='dot token'>.</span><span class='unresolved_namespaces identifier id'>unresolved_namespaces</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;, &quot;</span><span class='rparen token'>)</span>
</pre>
<p>
which returns
</p>
<pre class="code">
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.fcla.edu/</span><span class='dls identifier id'>dls</span><span class='div op'>/</span><span class='md identifier id'>md</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='div op'>/</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.fcla.edu/</span><span class='dls identifier id'>dls</span><span class='div op'>/</span><span class='md identifier id'>md</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.fcla.edu/</span><span class='dls identifier id'>dls</span><span class='div op'>/</span><span class='md identifier id'>md</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='div op'>/</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.fcla.edu/</span><span class='dls identifier id'>dls</span><span class='div op'>/</span><span class='md identifier id'>md</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='div op'>/</span><span class='daitssAccount identifier id'>daitssAccount</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.fcla.edu/</span><span class='dls identifier id'>dls</span><span class='div op'>/</span><span class='md identifier id'>md</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='div op'>/</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.fcla.edu/</span><span class='dls identifier id'>dls</span><span class='div op'>/</span><span class='md identifier id'>md</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='div op'>/</span><span class='daitssAccountProject identifier id'>daitssAccountProject</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
   <span class='dot3 op'>...</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.fcla.edu/</span><span class='dls identifier id'>dls</span><span class='div op'>/</span><span class='md identifier id'>md</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='div op'>/</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.fcla.edu/</span><span class='dls identifier id'>dls</span><span class='div op'>/</span><span class='md identifier id'>md</span><span class='div op'>/</span><span class='daitss identifier id'>daitss</span><span class='div op'>/</span><span class='daitssWaveFile identifier id'>daitssWaveFile</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.loc.gov/</span><span class='METS constant id'>METS</span><span class='div op'>/</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.loc.gov/s</span><span class='tandards identifier id'>tandards</span><span class='div op'>/</span><span class='mets identifier id'>mets</span><span class='div op'>/</span><span class='mets identifier id'>mets</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.loc.gov/</span><span class='mods identifier id'>mods</span><span class='div op'>/</span><span class='v3 identifier id'>v3</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.loc.gov/s</span><span class='tandards identifier id'>tandards</span><span class='div op'>/</span><span class='mods identifier id'>mods</span><span class='div op'>/</span><span class='v3 identifier id'>v3</span><span class='div op'>/</span><span class='mods identifier id'>mods</span><span class='minus op'>-</span><span class='integer val'>3</span><span class='minus op'>-</span><span class='float val'>3</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.w3.org/</span><span class='XML constant id'>XML</span><span class='div op'>/</span><span class='integer val'>1998</span><span class='div op'>/</span><span class='namespace identifier id'>namespace</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.loc.gov/s</span><span class='tandards identifier id'>tandards</span><span class='div op'>/</span><span class='mods identifier id'>mods</span><span class='div op'>/</span><span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.w3.org/</span><span class='integer val'>1999</span><span class='div op'>/</span><span class='xlink identifier id'>xlink</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.loc.gov/s</span><span class='tandards identifier id'>tandards</span><span class='div op'>/</span><span class='xlink identifier id'>xlink</span><span class='div op'>/</span><span class='xlink identifier id'>xlink</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.uflib.ufl.edu/</span><span class='digital identifier id'>digital</span><span class='div op'>/</span><span class='metadata identifier id'>metadata</span><span class='div op'>/</span><span class='ufdc2 identifier id'>ufdc2</span><span class='div op'>/</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.uflib.ufl.edu/</span><span class='digital identifier id'>digital</span><span class='div op'>/</span><span class='metadata identifier id'>metadata</span><span class='div op'>/</span><span class='ufdc2 identifier id'>ufdc2</span><span class='div op'>/</span><span class='ufdc2 identifier id'>ufdc2</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.w3.org/</span><span class='XML constant id'>XML</span><span class='div op'>/</span><span class='integer val'>1998</span><span class='div op'>/</span><span class='namespace identifier id'>namespace</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.w3.org/</span><span class='integer val'>2001</span><span class='div op'>/</span><span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.w3.org/</span><span class='integer val'>2001</span><span class='div op'>/</span><span class='XMLSchema constant id'>XMLSchema</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.w3.org/</span><span class='integer val'>2001</span><span class='div op'>/</span><span class='XMLSchema constant id'>XMLSchema</span><span class='dot token'>.</span><span class='xsd identifier id'>xsd</span>

  <span class='Unresolved constant id'>Unresolved</span><span class='colon op'>:</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.w3.org/</span><span class='integer val'>1999</span><span class='div op'>/</span><span class='xlink identifier id'>xlink</span><span class='comma token'>,</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.w3.org/</span><span class='integer val'>2001</span><span class='div op'>/</span><span class='XMLSchema constant id'>XMLSchema</span><span class='minus op'>-</span><span class='instance identifier id'>instance</span>
</pre>
<p>
Two notes on squid caching proxies: at least by default, redirects are not
cached (even 301 &#8220;moved permanently&#8221;) so that there will always
be a request to the original host resulting in a redirect that we will
handle (though the URL we are directed to will usually be cached) - an
example is <a
href="http://www.loc.gov/mods/v3/mods-3-2.xsd">www.loc.gov/mods/v3/mods-3-2.xsd</a>.
Secondly, there are common schemas, such as <a
href="http://dublincore.org/schemas/xmls/simpledc20021212.xsd">dublincore.org/schemas/xmls/simpledc20021212.xsd</a>,
that squid cannot cache since there is no Last-Modified, Etag, or
caching/expiration information associated with it. These kinds of issues
slow us down somewhat.
</p>


  </div>
</div>
<div class="tags">
  
</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="XmlResolverReloaded.html" title="XmlResolution::XmlResolverReloaded (class)">XmlResolverReloaded</a></span></p>
</div>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="NAMESPACE_DONT_TELL-constant" class="">NAMESPACE_DONT_TELL =
          <div class="docstring">
  <div class="discussion">
    <p>
There exist basic namespaces that schema-processors &#8216;just know
about&#8217;, and they are not normally downloaded when encountered (for
instance, <a
href="http://www.w3.org/2001/XMLSchema.xsd">www.w3.org/2001/XMLSchema.xsd</a>
and <a href="http://www.w3.org/2001/xml.xsd">www.w3.org/2001/xml.xsd</a>). 
We, however, do currently download those.
</p>
<p>
In other cases there are no actual schemas at all - schema-processors
really do have to interpret them.
</p>
<p>
For this latter case we do not want to report them as unresolved
namespaces. NAMESPACE_DONT_TELL is the place to list them.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbrack token'>[</span>
 <span class='string val'>'http://www.w3.org/1999/xhtml'</span><span class='comma token'>,</span>
 <span class='string val'>'http://www.w3.org/2001/XMLSchema-hasFacetAndProperty'</span><span class='comma token'>,</span>
 <span class='string val'>'http://www.w3.org/2001/XMLSchema-instance'</span>
<span class='rbrack token'>]</span>
</pre></dd>
      
        <dt id="TOO_MANY_SCHEMAS-constant" class="">TOO_MANY_SCHEMAS =
          <div class="docstring">
  <div class="discussion">
    <p>
To avoid potential denial of service attacks (even if self-inflicted),
limit the number of schemas we are willing to process for one XML instance
document.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='integer val'>500</span>
</pre></dd>
      
    </dl>
  


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="private ">
  <span class="summary_signature">
    
      <a href="#collections_storage_directory-instance_method" title="#collections_storage_directory (instance method)">- (Object) <strong>collections_storage_directory</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A writable directory for storing information about a collection of XML
documents.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#document_identifier-instance_method" title="#document_identifier (instance method)">- (Object) <strong>document_identifier</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A unique identifer for the document text.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#document_size-instance_method" title="#document_size (instance method)">- (Object) <strong>document_size</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The length of the document.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#document_text-instance_method" title="#document_text (instance method)">- (Object) <strong>document_text</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The text of the XML document we&#8217;ll resolve.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#document_uri-instance_method" title="#document_uri (instance method)">- (Object) <strong>document_uri</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A file URL constructed from the original filename of the document.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#errors-instance_method" title="#errors (instance method)">- (Object) <strong>errors</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
errors is an array of errors encountered in processing the docment.
</p>
</div></span>
  
</li>

    
      <li class="private ">
  <span class="summary_signature">
    
      <a href="#proxy-instance_method" title="#proxy (instance method)">- (Object) <strong>proxy</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The proxy to use when gathering schemas.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolution_time-instance_method" title="#resolution_time (instance method)">- (Object) <strong>resolution_time</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
resolution_time shows the time we began to process the XML document.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#schema_dictionary-instance_method" title="#schema_dictionary (instance method)">- (Object) <strong>schema_dictionary</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
schema_dictionary is a array of Structs that provides data about schemas.
</p>
</div></span>
  
</li>

    
      <li class="private ">
  <span class="summary_signature">
    
      <a href="#schemas_storage_directory-instance_method" title="#schemas_storage_directory (instance method)">- (Object) <strong>schemas_storage_directory</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A writable directory for storing retrieved schema documents.
</p>
</div></span>
  
</li>

    
      <li class="private ">
  <span class="summary_signature">
    
      <a href="#used_namespaces-instance_method" title="#used_namespaces (instance method)">- (Object) <strong>used_namespaces</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
used_namespaces is meant to be used as a list of unique namespaces that
have been directly used by an XML document or one of its schemas.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#analyze_schema_document-instance_method" title="#analyze_schema_document (instance method)">- (Object) <strong>analyze_schema_document</strong>(schema_location, schema_text, namespaces) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#analyze_xml_document-instance_method" title="#analyze_xml_document (instance method)">- (Object) <strong>analyze_xml_document</strong>(text) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#dump-instance_method" title="#dump (instance method)">- (Object) <strong>dump</strong> </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
dump.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (XmlResolver) <strong>initialize</strong>(document_text, document_uri, data_root, proxy = nil) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
new DOCUMENT_TEXT, DOCUMENT_URI, DATA_ROOT, [ PROXY ].
</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#mint_event_id-instance_method" title="#mint_event_id (instance method)">- (Object) <strong>mint_event_id</strong> </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#premis_report-instance_method" title="#premis_report (instance method)">- (Object) <strong>premis_report</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#process-instance_method" title="#process (instance method)">- (Object) <strong>process</strong> </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
process.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save-instance_method" title="#save (instance method)">- (Object) <strong>save</strong>(collection_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
save COLLECTION_ID.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unresolved_namespaces-instance_method" title="#unresolved_namespaces (instance method)">- (Object) <strong>unresolved_namespaces</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
unresolved_namespaces.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="XmlResolution::XmlResolver (class)">XmlResolver</a></span></tt>) <strong>initialize</strong>(document_text, document_uri, data_root, proxy = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
new DOCUMENT_TEXT, DOCUMENT_URI, DATA_ROOT, [ PROXY ]
</p>
<p>
Create a new XmlResolver object. The XML document is provided as the string
DOCUMENT_TEXT, an externally-supplied identifier as the string DOCUMENT_URI
(normally a file URL).  DATA_ROOT, a string, provides the path to the
parent directory where schemas and collections of information about the
resolved DOCUMENT_TEXT will be stored.  PROXY, if supplied, points to a
proxy, to allow a caching proxy to be used.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="InadequateDataError.html" title="XmlResolution::InadequateDataError (class)">InadequateDataError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 155</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='document_text identifier id'>document_text</span><span class='comma token'>,</span> <span class='document_uri identifier id'>document_uri</span><span class='comma token'>,</span> <span class='data_root identifier id'>data_root</span><span class='comma token'>,</span> <span class='proxy identifier id'>proxy</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  
  <span class='@document_text ivar id'>@document_text</span>        <span class='assign token'>=</span> <span class='document_text identifier id'>document_text</span>
  <span class='@document_identifier ivar id'>@document_identifier</span>  <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='document_text identifier id'>document_text</span><span class='rparen token'>)</span>
  <span class='@document_uri ivar id'>@document_uri</span>         <span class='assign token'>=</span> <span class='document_uri identifier id'>document_uri</span>
  <span class='@proxy ivar id'>@proxy</span>                <span class='assign token'>=</span> <span class='proxy identifier id'>proxy</span>
  <span class='@document_size ivar id'>@document_size</span>        <span class='assign token'>=</span> <span class='document_text identifier id'>document_text</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  
  <span class='@used_namespaces ivar id'>@used_namespaces</span>      <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@schema_dictionary ivar id'>@schema_dictionary</span>    <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@errors ivar id'>@errors</span>               <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>   <span class='comment val'># only errors in the instance document</span>

  <span class='@schemas_storage_directory ivar id'>@schemas_storage_directory</span>     <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='data_root identifier id'>data_root</span><span class='comma token'>,</span> <span class='string val'>'schemas'</span><span class='rparen token'>)</span>
  <span class='@collections_storage_directory ivar id'>@collections_storage_directory</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='data_root identifier id'>data_root</span><span class='comma token'>,</span> <span class='string val'>'collections'</span><span class='rparen token'>)</span>
  
  <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='check_directory identifier id'>check_directory</span> <span class='string val'>&quot;The schemas storage directory&quot;</span><span class='comma token'>,</span>     <span class='schemas_storage_directory identifier id'>schemas_storage_directory</span>  <span class='comment val'># raise ConfigurationError if issue</span>
  <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='check_directory identifier id'>check_directory</span> <span class='string val'>&quot;The document collection directory&quot;</span><span class='comma token'>,</span> <span class='collections_storage_directory identifier id'>collections_storage_directory</span>
  
  <span class='raise identifier id'>raise</span> <span class='InadequateDataError constant id'>InadequateDataError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;XML document #{document_uri} was empty&quot;</span> <span class='if if_mod kw'>if</span> <span class='document_size identifier id'>document_size</span> <span class='eq op'>==</span> <span class='integer val'>0</span>

  <span class='process identifier id'>process</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="collections_storage_directory-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="collections_storage_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>collections_storage_directory</strong>  <span class="extras">(readonly, private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A writable directory for storing information about a collection of XML
documents
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 94</span>

<span class='def def kw'>def</span> <span class='collections_storage_directory identifier id'>collections_storage_directory</span>
  <span class='@collections_storage_directory ivar id'>@collections_storage_directory</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="document_identifier-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="document_identifier-instance_method">
  
    - (<tt>Object</tt>) <strong>document_identifier</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A unique identifer for the document text. It is the MD5 hex digest of the
document.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 119</span>

<span class='def def kw'>def</span> <span class='document_identifier identifier id'>document_identifier</span>
  <span class='@document_identifier ivar id'>@document_identifier</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="document_size-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="document_size-instance_method">
  
    - (<tt>Object</tt>) <strong>document_size</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The length of the document
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 123</span>

<span class='def def kw'>def</span> <span class='document_size identifier id'>document_size</span>
  <span class='@document_size ivar id'>@document_size</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="document_text-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="document_text-instance_method">
  
    - (<tt>Object</tt>) <strong>document_text</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The text of the XML document we&#8217;ll resolve.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 115</span>

<span class='def def kw'>def</span> <span class='document_text identifier id'>document_text</span>
  <span class='@document_text ivar id'>@document_text</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="document_uri-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="document_uri-instance_method">
  
    - (<tt>Object</tt>) <strong>document_uri</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A file URL constructed from the original filename of the document.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 127</span>

<span class='def def kw'>def</span> <span class='document_uri identifier id'>document_uri</span>
  <span class='@document_uri ivar id'>@document_uri</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="errors-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="errors-instance_method">
  
    - (<tt>Object</tt>) <strong>errors</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
errors is an array of errors encountered in processing the docment.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 136</span>

<span class='def def kw'>def</span> <span class='errors identifier id'>errors</span>
  <span class='@errors ivar id'>@errors</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="proxy-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="proxy-instance_method">
  
    - (<tt>Object</tt>) <strong>proxy</strong>  <span class="extras">(readonly, private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The proxy to use when gathering schemas. If nil, go directly to the source.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 98</span>

<span class='def def kw'>def</span> <span class='proxy identifier id'>proxy</span>
  <span class='@proxy ivar id'>@proxy</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="resolution_time-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="resolution_time-instance_method">
  
    - (<tt>Object</tt>) <strong>resolution_time</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
resolution_time shows the time we began to process the XML document.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 111</span>

<span class='def def kw'>def</span> <span class='resolution_time identifier id'>resolution_time</span>
  <span class='@resolution_time ivar id'>@resolution_time</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="schema_dictionary-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="schema_dictionary-instance_method">
  
    - (<tt>Object</tt>) <strong>schema_dictionary</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
schema_dictionary is a array of Structs that provides data about schemas. 
See documentation for XmlResolution::SchemaCatalog.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 132</span>

<span class='def def kw'>def</span> <span class='schema_dictionary identifier id'>schema_dictionary</span>
  <span class='@schema_dictionary ivar id'>@schema_dictionary</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="schemas_storage_directory-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="schemas_storage_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>schemas_storage_directory</strong>  <span class="extras">(readonly, private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A writable directory for storing retrieved schema documents.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 90</span>

<span class='def def kw'>def</span> <span class='schemas_storage_directory identifier id'>schemas_storage_directory</span>
  <span class='@schemas_storage_directory ivar id'>@schemas_storage_directory</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="used_namespaces-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="used_namespaces-instance_method">
  
    - (<tt>Object</tt>) <strong>used_namespaces</strong>  <span class="extras">(readonly, private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
used_namespaces is meant to be used as a list of unique namespaces that
have been directly used by an XML document or one of its schemas.  It is a
hash where the values are irrelevant; only the keys are important.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 105</span>

<span class='def def kw'>def</span> <span class='used_namespaces identifier id'>used_namespaces</span>
  <span class='@used_namespaces ivar id'>@used_namespaces</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="analyze_schema_document-instance_method">
  
    - (<tt>Object</tt>) <strong>analyze_schema_document</strong>(schema_location, schema_text, namespaces)  <span class="extras">(private)</span>
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


451
452
453
454
455</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 451</span>

<span class='def def kw'>def</span> <span class='analyze_schema_document identifier id'>analyze_schema_document</span> <span class='schema_location identifier id'>schema_location</span><span class='comma token'>,</span> <span class='schema_text identifier id'>schema_text</span><span class='comma token'>,</span> <span class='namespaces identifier id'>namespaces</span>
  <span class='document identifier id'>document</span> <span class='assign token'>=</span> <span class='SchemaDocument constant id'>SchemaDocument</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='schema_location identifier id'>schema_location</span><span class='comma token'>,</span> <span class='namespaces identifier id'>namespaces</span><span class='rparen token'>)</span>
  <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='SAX constant id'>SAX</span><span class='colon2 op'>::</span><span class='Parser constant id'>Parser</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='document identifier id'>document</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='schema_text identifier id'>schema_text</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='document identifier id'>document</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="analyze_xml_document-instance_method">
  
    - (<tt>Object</tt>) <strong>analyze_xml_document</strong>(text)  <span class="extras">(private)</span>
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


445
446
447
448
449</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 445</span>

<span class='def def kw'>def</span> <span class='analyze_xml_document identifier id'>analyze_xml_document</span> <span class='text identifier id'>text</span>
  <span class='document identifier id'>document</span> <span class='assign token'>=</span> <span class='PlainXmlDocument constant id'>PlainXmlDocument</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='SAX constant id'>SAX</span><span class='colon2 op'>::</span><span class='Parser constant id'>Parser</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='document identifier id'>document</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='text identifier id'>text</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='document identifier id'>document</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="dump-instance_method">
  
    - (<tt>Object</tt>) <strong>dump</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
dump
</p>
<p>
Return a string representation of our analysis of an xml document, along
the lines of:
</p>
<pre class="code">
 <span class='FILE_NAME constant id'>FILE_NAME</span> <span class='url identifier id'>url</span>
 <span class='DIGEST constant id'>DIGEST</span> <span class='md5 identifier id'>md5</span>
 <span class='SIZE constant id'>SIZE</span> <span class='fixnum identifier id'>fixnum</span>
 <span class='DATE_TIME constant id'>DATE_TIME</span> <span class='time identifier id'>time</span>
 <span class='SCHEMA constant id'>SCHEMA</span> <span class='md5 identifier id'>md5</span> <span class='modification identifier id'>modification</span> <span class='location identifier id'>location</span> <span class='namespace identifier id'>namespace</span>
 <span class='SCHEMA constant id'>SCHEMA</span> <span class='md5 identifier id'>md5</span> <span class='modification identifier id'>modification</span> <span class='location identifier id'>location</span> <span class='namespace identifier id'>namespace</span>
 <span class='SCHEMA constant id'>SCHEMA</span> <span class='md5 identifier id'>md5</span> <span class='modification identifier id'>modification</span> <span class='location identifier id'>location</span> <span class='namespace identifier id'>namespace</span>
 <span class='SCHEMA constant id'>SCHEMA</span> <span class='md5 identifier id'>md5</span> <span class='modification identifier id'>modification</span> <span class='location identifier id'>location</span> <span class='namespace identifier id'>namespace</span>
  <span class='dot3 op'>...</span><span class='dot token'>.</span>
 <span class='BROKEN_SCHEMA constant id'>BROKEN_SCHEMA</span> <span class='location identifier id'>location</span> <span class='namespace identifier id'>namespace</span> <span class='error_message identifier id'>error_message</span>
 <span class='BROKEN_SCHEMA constant id'>BROKEN_SCHEMA</span> <span class='location identifier id'>location</span> <span class='namespace identifier id'>namespace</span> <span class='error_message identifier id'>error_message</span>
  <span class='dot3 op'>...</span><span class='dot token'>.</span>
 <span class='REDIRECTED_SCHEMA constant id'>REDIRECTED_SCHEMA</span> <span class='location identifier id'>location</span> <span class='namespace identifier id'>namespace</span> <span class='redirected_locaton identifier id'>redirected_locaton</span>
 <span class='REDIRECTED_SCHEMA constant id'>REDIRECTED_SCHEMA</span> <span class='location identifier id'>location</span> <span class='namespace identifier id'>namespace</span> <span class='redirected_locaton identifier id'>redirected_locaton</span>
  <span class='dot3 op'>...</span>
 <span class='ERROR constant id'>ERROR</span> <span class='message identifier id'>message</span>
 <span class='ERROR constant id'>ERROR</span> <span class='message identifier id'>message</span>
 <span class='dot3 op'>...</span><span class='dot token'>.</span>
 <span class='UNRESOLVED_NAMESPACES constant id'>UNRESOLVED_NAMESPACES</span> <span class='namespace identifier id'>namespace</span> <span class='namespace identifier id'>namespace</span> <span class='namespace identifier id'>namespace</span> <span class='dot3 op'>...</span><span class='dot token'>.</span>
</pre>
<p>
Each &#8216;phrase&#8217; is URL-escaped, so embeded whitespace won&#8217;t
cause parsing problems.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 483</span>

<span class='def def kw'>def</span> <span class='dump identifier id'>dump</span>
  <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='string val'>''</span>
  <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;FILE_NAME&quot;</span><span class='comma token'>,</span> <span class='document_uri identifier id'>document_uri</span><span class='rparen token'>)</span>            <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>
  <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;DATE_TIME&quot;</span><span class='comma token'>,</span> <span class='resolution_time identifier id'>resolution_time</span><span class='dot token'>.</span><span class='iso8601 identifier id'>iso8601</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>
  <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;DIGEST&quot;</span><span class='comma token'>,</span>    <span class='document_identifier identifier id'>document_identifier</span><span class='rparen token'>)</span>     <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>
  <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;LENGTH&quot;</span><span class='comma token'>,</span>    <span class='document_size identifier id'>document_size</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>      <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>

  <span class='schema_dictionary identifier id'>schema_dictionary</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span>
    <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='retrieval_status identifier id'>retrieval_status</span> <span class='eq op'>==</span> <span class='symbol val'>:success</span>
    <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;SCHEMA&quot;</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='digest identifier id'>digest</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='last_modified identifier id'>last_modified</span><span class='dot token'>.</span><span class='iso8601 identifier id'>iso8601</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='location identifier id'>location</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='namespace identifier id'>namespace</span><span class='rparen token'>)</span>   <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>
  <span class='end end kw'>end</span>

  <span class='schema_dictionary identifier id'>schema_dictionary</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span>
    <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='retrieval_status identifier id'>retrieval_status</span> <span class='eq op'>==</span> <span class='symbol val'>:failure</span>
    <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;BROKEN_SCHEMA&quot;</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='location identifier id'>location</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='namespace identifier id'>namespace</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='error_message identifier id'>error_message</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>
  <span class='end end kw'>end</span>

  <span class='schema_dictionary identifier id'>schema_dictionary</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span>
    <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='retrieval_status identifier id'>retrieval_status</span> <span class='eq op'>==</span> <span class='symbol val'>:redirect</span>
    <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;REDIRECTED_SCHEMA&quot;</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='location identifier id'>location</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='namespace identifier id'>namespace</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='redirected_location identifier id'>redirected_location</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>
  <span class='end end kw'>end</span>

  <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='mess identifier id'>mess</span><span class='bitor op'>|</span>
    <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;ERROR&quot;</span><span class='comma token'>,</span> <span class='mess identifier id'>mess</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>
  <span class='end end kw'>end</span>

  <span class='str identifier id'>str</span> <span class='opasgn op'>+=</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='string val'>&quot;UNRESOLVED_NAMESPACES&quot;</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='unresolved_namespaces identifier id'>unresolved_namespaces</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>&quot;\n&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="mint_event_id-instance_method">
  
    - (<tt>Object</tt>) <strong>mint_event_id</strong>  <span class="extras">(private)</span>
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


441
442
443</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 441</span>

<span class='def def kw'>def</span> <span class='mint_event_id identifier id'>mint_event_id</span>
  <span class='string val'>'file://'</span> <span class='plus op'>+</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='gethostname identifier id'>gethostname</span>  <span class='plus op'>+</span> <span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='SEPARATOR constant id'>SEPARATOR</span> <span class='plus op'>+</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>'xmlresolution'</span><span class='comma token'>,</span> <span class='string val'>'events'</span><span class='comma token'>,</span> <span class='document_identifier identifier id'>document_identifier</span> <span class='plus op'>+</span> <span class='string val'>'-'</span> <span class='plus op'>+</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='rand identifier id'>rand</span><span class='lparen token'>(</span><span class='integer val'>1_000_000_000_000</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>5</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="premis_report-instance_method">
  
    - (<tt>Object</tt>) <strong>premis_report</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 267</span>

<span class='def def kw'>def</span> <span class='premis_report identifier id'>premis_report</span>

  <span class='$KCODE gvar id'>$KCODE</span> <span class='eq op'>==</span> <span class='string val'>'UTF8'</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Ruby $KCODE == #{$KCODE}, but it must be UTF8&quot;</span>
  
  <span class='successes identifier id'>successes</span> <span class='assign token'>=</span> <span class='failures identifier id'>failures</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  
  <span class='schema_dictionary identifier id'>schema_dictionary</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span>
    <span class='case case kw'>case</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='retrieval_status identifier id'>retrieval_status</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:failure</span>            <span class='semicolon token'>;</span>  <span class='failures identifier id'>failures</span>  <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:success</span><span class='comma token'>,</span> <span class='symbol val'>:redirect</span> <span class='semicolon token'>;</span>  <span class='successes identifier id'>successes</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='successes identifier id'>successes</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='failures identifier id'>failures</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='outcome identifier id'>outcome</span> <span class='assign token'>=</span> <span class='string val'>'mixed'</span>
  <span class='elsif elsif kw'>elsif</span> <span class='failures identifier id'>failures</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='outcome identifier id'>outcome</span> <span class='assign token'>=</span> <span class='string val'>'failure'</span>
  <span class='else else kw'>else</span>
    <span class='outcome identifier id'>outcome</span> <span class='assign token'>=</span> <span class='string val'>'success'</span>  <span class='comment val'># Vacuous case will be a success.</span>
  <span class='end end kw'>end</span>
  
  <span class='broken_links identifier id'>broken_links</span> <span class='assign token'>=</span> <span class='schema_dictionary identifier id'>schema_dictionary</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='location identifier id'>location</span> <span class='if if_mod kw'>if</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='retrieval_status identifier id'>retrieval_status</span> <span class='eq op'>==</span> <span class='symbol val'>:failure</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
  <span class='event_id identifier id'>event_id</span> <span class='assign token'>=</span> <span class='mint_event_id identifier id'>mint_event_id</span>
  
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
  
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='instruct! fid id'>instruct!</span><span class='lparen token'>(</span><span class='symbol val'>:xml</span><span class='comma token'>,</span> <span class='symbol val'>:encoding</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'UTF-8'</span><span class='rparen token'>)</span>

  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='premis identifier id'>premis</span><span class='lparen token'>(</span><span class='string val'>'xmlns'</span>              <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'info:lc/xmlns/premis-v2'</span><span class='comma token'>,</span>
             <span class='string val'>'xmlns:xsi'</span>          <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://www.w3.org/2001/XMLSchema-instance'</span><span class='comma token'>,</span>
             <span class='string val'>'xsi:schemaLocation'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'info:lc/xmlns/premis-v2 http://www.loc.gov/standards/premis/premis.xsd'</span><span class='comma token'>,</span>
             <span class='string val'>'version'</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'2.0'</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span>

    <span class='comment val'># The object portion, strictly speaking, is not needed by DAITSS 2, it will be replaced.</span>
    <span class='comment val'># However, it turns out to be useful validating the output, and may be useful in other</span>
    <span class='comment val'># contexts.</span>

    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='object identifier id'>object</span><span class='lparen token'>(</span><span class='string val'>'xsi:type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'file'</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='objectIdentifier identifier id'>objectIdentifier</span> <span class='lbrace token'>{</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='objectIdentifierType identifier id'>objectIdentifierType</span><span class='lparen token'>(</span><span class='string val'>'URI'</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='objectIdentifierValue identifier id'>objectIdentifierValue</span><span class='lparen token'>(</span><span class='document_uri identifier id'>document_uri</span><span class='rparen token'>)</span>
      <span class='rbrace token'>}</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='objectCharacteristics identifier id'>objectCharacteristics</span> <span class='lbrace token'>{</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='compositionLevel identifier id'>compositionLevel</span><span class='lparen token'>(</span><span class='string val'>'0'</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='fixity identifier id'>fixity</span> <span class='lbrace token'>{</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='messageDigestAlgorithm identifier id'>messageDigestAlgorithm</span><span class='lparen token'>(</span><span class='string val'>'MD5'</span><span class='rparen token'>)</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='messageDigest identifier id'>messageDigest</span><span class='lparen token'>(</span><span class='document_identifier identifier id'>document_identifier</span><span class='rparen token'>)</span>
        <span class='rbrace token'>}</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='lparen token'>(</span><span class='document_size identifier id'>document_size</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='format identifier id'>format</span> <span class='lbrace token'>{</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='formatDesignation identifier id'>formatDesignation</span> <span class='lbrace token'>{</span>
            <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='formatName identifier id'>formatName</span><span class='lparen token'>(</span><span class='string val'>'XML'</span><span class='rparen token'>)</span>
            <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='formatVersion identifier id'>formatVersion</span><span class='lparen token'>(</span><span class='string val'>'1.0'</span><span class='rparen token'>)</span>
          <span class='rbrace token'>}</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='formatRegistry identifier id'>formatRegistry</span> <span class='lbrace token'>{</span>
            <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='formatRegistryName identifier id'>formatRegistryName</span><span class='lparen token'>(</span><span class='string val'>'http://www.nationalarchives.gov.uk/pronom'</span><span class='rparen token'>)</span>
            <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='formatRegistryKey identifier id'>formatRegistryKey</span><span class='lparen token'>(</span><span class='string val'>'fmt/101'</span><span class='rparen token'>)</span>
          <span class='rbrace token'>}</span>
        <span class='rbrace token'>}</span>
      <span class='rbrace token'>}</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingEventIdentifier identifier id'>linkingEventIdentifier</span> <span class='lbrace token'>{</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingEventIdentifierType identifier id'>linkingEventIdentifierType</span><span class='lparen token'>(</span><span class='string val'>'URI'</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingEventIdentifierValue identifier id'>linkingEventIdentifierValue</span><span class='lparen token'>(</span><span class='event_id identifier id'>event_id</span><span class='rparen token'>)</span>
      <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>

    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='event identifier id'>event</span> <span class='lbrace token'>{</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventIdentifier identifier id'>eventIdentifier</span> <span class='lbrace token'>{</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventIdentifierType identifier id'>eventIdentifierType</span><span class='lparen token'>(</span><span class='string val'>'URI'</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventIdentifierValue identifier id'>eventIdentifierValue</span><span class='lparen token'>(</span><span class='event_id identifier id'>event_id</span><span class='rparen token'>)</span>   <span class='comment val'># Typically this is only used as a placeholder</span>
      <span class='rbrace token'>}</span>                                      <span class='comment val'># and will be re-written.</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventType identifier id'>eventType</span><span class='lparen token'>(</span><span class='string val'>'XML Resolution'</span><span class='rparen token'>)</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventDateTime identifier id'>eventDateTime</span><span class='lparen token'>(</span><span class='@resolution_time ivar id'>@resolution_time</span><span class='dot token'>.</span><span class='iso8601 identifier id'>iso8601</span><span class='rparen token'>)</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventOutcomeInformation identifier id'>eventOutcomeInformation</span> <span class='lbrace token'>{</span> 
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventOutcome identifier id'>eventOutcome</span><span class='lparen token'>(</span><span class='outcome identifier id'>outcome</span><span class='rparen token'>)</span> 
        <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='unresolved_namespaces identifier id'>unresolved_namespaces</span><span class='dot token'>.</span><span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='broken_links identifier id'>broken_links</span><span class='dot token'>.</span><span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventOutcomeDetail identifier id'>eventOutcomeDetail</span> <span class='lbrace token'>{</span>
            <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='eventOutcomeDetailExtension identifier id'>eventOutcomeDetailExtension</span> <span class='lbrace token'>{</span>
              <span class='broken_links identifier id'>broken_links</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='loc identifier id'>loc</span><span class='bitor op'>|</span> <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='broken_link identifier id'>broken_link</span><span class='lparen token'>(</span><span class='loc identifier id'>loc</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
              <span class='unresolved_namespaces identifier id'>unresolved_namespaces</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='ns identifier id'>ns</span><span class='bitor op'>|</span> <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='unresolved_namespace identifier id'>unresolved_namespace</span><span class='lparen token'>(</span><span class='ns identifier id'>ns</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
            <span class='rbrace token'>}</span>
          <span class='rbrace token'>}</span>
        <span class='end end kw'>end</span>
      <span class='rbrace token'>}</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingAgentIdentifier identifier id'>linkingAgentIdentifier</span> <span class='lbrace token'>{</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingAgentIdentifierType identifier id'>linkingAgentIdentifierType</span><span class='lparen token'>(</span><span class='string val'>'URI'</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingAgentIdentifierValue identifier id'>linkingAgentIdentifierValue</span><span class='lparen token'>(</span><span class='XmlResolution constant id'>XmlResolution</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='dot token'>.</span><span class='uri identifier id'>uri</span><span class='rparen token'>)</span>
      <span class='rbrace token'>}</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingObjectIdentifier identifier id'>linkingObjectIdentifier</span> <span class='lbrace token'>{</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingObjectIdentifierType identifier id'>linkingObjectIdentifierType</span><span class='lparen token'>(</span><span class='string val'>'URI'</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='linkingObjectIdentifierValue identifier id'>linkingObjectIdentifierValue</span><span class='lparen token'>(</span><span class='document_uri identifier id'>document_uri</span><span class='rparen token'>)</span>
      <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>

    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='agent identifier id'>agent</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='agentIdentifier identifier id'>agentIdentifier</span> <span class='lbrace token'>{</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='agentIdentifierType identifier id'>agentIdentifierType</span><span class='lparen token'>(</span><span class='string val'>'URI'</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='agentIdentifierValue identifier id'>agentIdentifierValue</span><span class='lparen token'>(</span><span class='XmlResolution constant id'>XmlResolution</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='dot token'>.</span><span class='uri identifier id'>uri</span><span class='rparen token'>)</span>
      <span class='rbrace token'>}</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='agentName identifier id'>agentName</span><span class='lparen token'>(</span><span class='string val'>'XML Resolution Service'</span><span class='rparen token'>)</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='agentType identifier id'>agentType</span><span class='lparen token'>(</span><span class='string val'>'Web Service'</span><span class='rparen token'>)</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='agentNote identifier id'>agentNote</span><span class='lparen token'>(</span><span class='XmlResolution constant id'>XmlResolution</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='dot token'>.</span><span class='rev identifier id'>rev</span><span class='comma token'>,</span> <span class='symbol val'>:xmlns</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'info:lc/xmlns/premis-v2-beta'</span><span class='rparen token'>)</span>  <span class='comment val'># xmlns won't work: marker for Franco's tests.</span>
    <span class='rbrace token'>}</span>
  <span class='rbrace token'>}</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="process-instance_method">
  
    - (<tt>Object</tt>) <strong>process</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
process
</p>
<p>
Process the XML instance document, downloading the schemas it references,
analyze the schemas, and  download the schemas <b>those</b> reference, and
so on, until we&#8217;re done.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 406</span>

<span class='def def kw'>def</span> <span class='process identifier id'>process</span>
  <span class='@resolution_time ivar id'>@resolution_time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
  
  <span class='instance_document identifier id'>instance_document</span>   <span class='assign token'>=</span> <span class='analyze_xml_document identifier id'>analyze_xml_document</span><span class='lparen token'>(</span><span class='document_text identifier id'>document_text</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='instance_document identifier id'>instance_document</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='neq op'>!=</span> <span class='string val'>'1.0'</span>
    <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='BadXmlVersion constant id'>BadXmlVersion</span><span class='comma token'>,</span> <span class='dstring node'>&quot;This service only supports XML Version 1.0. This document is XML Version #{instance_document.version}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='namespace_locations identifier id'>namespace_locations</span> <span class='assign token'>=</span> <span class='instance_document identifier id'>instance_document</span><span class='dot token'>.</span><span class='namespace_locations identifier id'>namespace_locations</span>   <span class='comment val'># a hash of Location-URL =&gt; Namespace-URN pairs</span>
  <span class='@used_namespaces ivar id'>@used_namespaces</span>    <span class='assign token'>=</span> <span class='instance_document identifier id'>instance_document</span><span class='dot token'>.</span><span class='used_namespaces identifier id'>used_namespaces</span>       <span class='comment val'># a hash of Namespace-URN =&gt; 'true' pairs </span>

  <span class='@errors ivar id'>@errors</span> <span class='assign token'>=</span> <span class='instance_document identifier id'>instance_document</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span>

  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='instance_document identifier id'>instance_document</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='namespace_locations identifier id'>namespace_locations</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='and and kw'>and</span> <span class='@used_namespaces ivar id'>@used_namespaces</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='BadBadXmlDocument constant id'>BadBadXmlDocument</span><span class='comma token'>,</span> <span class='dstring node'>&quot;The XML document #{document_uri} had too many errors: &quot;</span> <span class='plus op'>+</span> <span class='instance_document identifier id'>instance_document</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>'; '</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='catalog identifier id'>catalog</span> <span class='assign token'>=</span> <span class='SchemaCatalog constant id'>SchemaCatalog</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='namespace_locations identifier id'>namespace_locations</span><span class='comma token'>,</span> <span class='schemas_storage_directory identifier id'>schemas_storage_directory</span><span class='comma token'>,</span> <span class='proxy identifier id'>proxy</span><span class='rparen token'>)</span>

  <span class='count identifier id'>count</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='catalog identifier id'>catalog</span><span class='dot token'>.</span><span class='schemas identifier id'>schemas</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='schema_record identifier id'>schema_record</span><span class='bitor op'>|</span>
    <span class='count identifier id'>count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='schema_record identifier id'>schema_record</span><span class='dot token'>.</span><span class='retrieval_status identifier id'>retrieval_status</span> <span class='neq op'>!=</span> <span class='symbol val'>:success</span>
    <span class='schema_document identifier id'>schema_document</span> <span class='assign token'>=</span> <span class='analyze_schema_document identifier id'>analyze_schema_document</span><span class='lparen token'>(</span><span class='schema_record identifier id'>schema_record</span><span class='dot token'>.</span><span class='location identifier id'>location</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='schema_record identifier id'>schema_record</span><span class='dot token'>.</span><span class='localpath identifier id'>localpath</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='@used_namespaces ivar id'>@used_namespaces</span><span class='rparen token'>)</span>
    <span class='catalog identifier id'>catalog</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span> <span class='schema_document identifier id'>schema_document</span><span class='dot token'>.</span><span class='namespace_locations identifier id'>namespace_locations</span>

    <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='TooManyDarnSchemas constant id'>TooManyDarnSchemas</span><span class='comma token'>,</span>  <span class='dstring node'>&quot;Too many schemas (#{count}) encountered for #{document_uri}.&quot;</span> <span class='if if_mod kw'>if</span> <span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='TOO_MANY_SCHEMAS constant id'>TOO_MANY_SCHEMAS</span>
  <span class='end end kw'>end</span>
  
  <span class='@schema_dictionary ivar id'>@schema_dictionary</span> <span class='assign token'>=</span> <span class='catalog identifier id'>catalog</span><span class='dot token'>.</span><span class='schemas identifier id'>schemas</span>   <span class='comment val'># only those actually required, that is, in used_namespaces</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="save-instance_method">
  
    - (<tt>Object</tt>) <strong>save</strong>(collection_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
save COLLECTION_ID
</p>
<p>
Serialize the data we&#8217;ve collected for the XML document, saving the
information in a format we can easily reread.  It is saved in the directory
named &#8230;/collections/COLLECTION_ID/; for the filename of the data we
use the MD5 checksum of the XML document.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="BadCollectionID.html" title="XmlResolution::BadCollectionID (class)">XmlResolution::BadCollectionID</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 382</span>

<span class='def def kw'>def</span> <span class='save identifier id'>save</span> <span class='collection_id identifier id'>collection_id</span>

  <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='BadCollectionID constant id'>BadCollectionID</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Invalid collection identifier '#{collection_id}'&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='collection_name_ok? fid id'>collection_name_ok?</span> <span class='collection_id identifier id'>collection_id</span>

  <span class='record_file identifier id'>record_file</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='collections_storage_directory identifier id'>collections_storage_directory</span><span class='comma token'>,</span> <span class='collection_id identifier id'>collection_id</span><span class='comma token'>,</span> <span class='document_identifier identifier id'>document_identifier</span><span class='rparen token'>)</span>

  <span class='begin begin kw'>begin</span>
    <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='check_directory identifier id'>check_directory</span> <span class='string val'>&quot;&quot;</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='collections_storage_directory identifier id'>collections_storage_directory</span><span class='comma token'>,</span> <span class='collection_id identifier id'>collection_id</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='raise identifier id'>raise</span> <span class='XmlResolution constant id'>XmlResolution</span><span class='colon2 op'>::</span><span class='BadCollectionID constant id'>BadCollectionID</span><span class='comma token'>,</span> <span class='dstring node'>&quot;The collection identifier '#{collection_id}' hasn't been created yet. Use PUT to create it first&quot;</span>
  <span class='end end kw'>end</span>

  <span class='ResolverUtils constant id'>ResolverUtils</span><span class='dot token'>.</span><span class='write_lock identifier id'>write_lock</span><span class='lparen token'>(</span><span class='record_file identifier id'>record_file</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fd identifier id'>fd</span><span class='bitor op'>|</span>
    <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dump identifier id'>dump</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="unresolved_namespaces-instance_method">
  
    - (<tt>Object</tt>) <strong>unresolved_namespaces</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
unresolved_namespaces
</p>
<p>
Return an array of all of the namesapces that we have not been able to
resolve.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/xml_resolver.rb', line 183</span>

<span class='def def kw'>def</span> <span class='unresolved_namespaces identifier id'>unresolved_namespaces</span>   
  <span class='lparen token'>(</span><span class='@used_namespaces ivar id'>@used_namespaces</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='minus op'>-</span> <span class='schema_dictionary identifier id'>schema_dictionary</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='namespace identifier id'>namespace</span> <span class='rbrace token'>}</span> <span class='minus op'>-</span> <span class='NAMESPACE_DONT_TELL constant id'>NAMESPACE_DONT_TELL</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span><span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='cmp op'>&lt;=&gt;</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Fri Dec 17 14:14:24 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.0 (ruby-1.8.7).
</div>

  </body>
</html>