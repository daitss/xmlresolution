<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: XmlResolution::TarWriter</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (T)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../XmlResolution.html" title="XmlResolution (module)">XmlResolution</a></span></span>
     &raquo; 
    <span class="title">TarWriter</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: XmlResolution::TarWriter
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">XmlResolution::TarWriter</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb</dd>
  
</dl>
<div class="clear"></div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#fd-instance_method" title="#fd (instance method)">- (Object) <strong>fd</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A file descriptor we will write to.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ownership-instance_method" title="#ownership (instance method)">- (Object) <strong>ownership</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A hash having keys :uid, :gid, :username, :groupname, used to set ownership
for all files included in the tar file we produce.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">- (Object) <strong>close</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Write two 512-byte blocks of nul characters to end the tar file.
</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#header_checksum-instance_method" title="#header_checksum (instance method)">- (Object) <strong>header_checksum</strong>(buff) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Determine the checksum of a header BUFF.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (TarWriter) <strong>initialize</strong>(fd, file_ownership) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Create a object that will allow us to stream a tar file to given file
descriptor FD.
</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#make_header-instance_method" title="#make_header (instance method)">- (Object) <strong>make_header</strong>(file_path, tarfile_path) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Given the string FILE_PATH to a file and the string TARFILE_PATH, the
pathname to use for the tar entry, create a header for the file.
</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#standard_header-instance_method" title="#standard_header (instance method)">- (Object) <strong>standard_header</strong> </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Build a boilerplate header based on what we know won&#8217;t change: for
us, that&#8217;s plain files on plain filesystems with a global set of
ownership.
</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#to_octal-instance_method" title="#to_octal (instance method)">- (Object) <strong>to_octal</strong>(int, pad_length = nil) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Format INT as octal string, optionally prefix with leading zeros to fill
out to PAD length.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write-instance_method" title="#write (instance method)">- (Object) <strong>write</strong>(file_path, tar_path = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Write out a tar header for the file found at FILE_PATH, using the TAR_PATH
string as the filename in the tar file.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="XmlResolution::TarWriter (class)">TarWriter</a></span></tt>) <strong>initialize</strong>(fd, file_ownership) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Create a object that will allow us to stream a tar file to given file
descriptor FD.  The second argument FILE_OWNERSHIP, a hash, gives the :gid,
:uid, :username and :groupname to use for all files.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 59</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='fd identifier id'>fd</span><span class='comma token'>,</span> <span class='file_ownership identifier id'>file_ownership</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:gid</span><span class='comma token'>,</span> <span class='symbol val'>:uid</span><span class='comma token'>,</span> <span class='symbol val'>:username</span><span class='comma token'>,</span> <span class='symbol val'>:groupname</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='bitor op'>|</span> <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Missing required file ownership key #{key}.&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='file_ownership identifier id'>file_ownership</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
  <span class='@ownership ivar id'>@ownership</span>   <span class='assign token'>=</span> <span class='file_ownership identifier id'>file_ownership</span>
  <span class='@fd ivar id'>@fd</span>          <span class='assign token'>=</span> <span class='fd identifier id'>fd</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="fd-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="fd-instance_method">
  
    - (<tt>Object</tt>) <strong>fd</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A file descriptor we will write to.  It could be a StringIO object, if you
really want to get a string out of this class.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 53</span>

<span class='def def kw'>def</span> <span class='fd identifier id'>fd</span>
  <span class='@fd ivar id'>@fd</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="ownership-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="ownership-instance_method">
  
    - (<tt>Object</tt>) <strong>ownership</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A hash having keys :uid, :gid, :username, :groupname, used to set ownership
for all files included in the tar file we produce.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 48</span>

<span class='def def kw'>def</span> <span class='ownership identifier id'>ownership</span>
  <span class='@ownership ivar id'>@ownership</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="close-instance_method">
  
    - (<tt>Object</tt>) <strong>close</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Write two 512-byte blocks of nul characters to end the tar file.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 191</span>

<span class='def def kw'>def</span> <span class='close identifier id'>close</span>
  <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='integer val'>0</span><span class='dot token'>.</span><span class='chr identifier id'>chr</span> <span class='mult op'>*</span> <span class='integer val'>1024</span>
  <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="header_checksum-instance_method">
  
    - (<tt>Object</tt>) <strong>header_checksum</strong>(buff)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Determine the checksum of a header BUFF.  The location of the checksum
itself (at <a href="http://148..155">buff</a>) is treated as a string of
blanks.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 78</span>

<span class='def def kw'>def</span> <span class='header_checksum identifier id'>header_checksum</span> <span class='buff identifier id'>buff</span>
  <span class='sum identifier id'>sum</span> <span class='assign token'>=</span>  <span class='integer val'>0</span>
  <span class='lparen token'>(</span><span class='integer val'>0</span>   <span class='dot2 op'>..</span> <span class='integer val'>147</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='sum identifier id'>sum</span> <span class='opasgn op'>+=</span> <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
  <span class='lparen token'>(</span><span class='integer val'>156</span> <span class='dot2 op'>..</span> <span class='integer val'>511</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='sum identifier id'>sum</span> <span class='opasgn op'>+=</span> <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
  <span class='sum identifier id'>sum</span> <span class='plus op'>+</span> <span class='integer val'>32</span> <span class='mult op'>*</span> <span class='integer val'>8</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="make_header-instance_method">
  
    - (<tt>Object</tt>) <strong>make_header</strong>(file_path, tarfile_path)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Given the string FILE_PATH to a file and the string TARFILE_PATH, the
pathname to use for the tar entry, create a header for the file.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 128</span>

<span class='def def kw'>def</span> <span class='make_header identifier id'>make_header</span> <span class='file_path identifier id'>file_path</span><span class='comma token'>,</span> <span class='tarfile_path identifier id'>tarfile_path</span>

  <span class='fstat identifier id'>fstat</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='stat identifier id'>stat</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='rparen token'>)</span>
  <span class='buff identifier id'>buff</span>  <span class='assign token'>=</span> <span class='standard_header identifier id'>standard_header</span><span class='lparen token'>(</span><span class='rparen token'>)</span>

  <span class='comment val'># Set file-dependent headers</span>

  <span class='comment val'># Filename - left justified in position 0..99</span>
  <span class='comment val'># we try to fix up overlong file name, try to leave something useful</span>

  <span class='filename identifier id'>filename</span> <span class='assign token'>=</span> <span class='tarfile_path identifier id'>tarfile_path</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>100</span><span class='rbrack token'>]</span>
  <span class='filename identifier id'>filename</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/\/+$/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='filename identifier id'>filename</span>

  <span class='comment val'># file mode: 6 octal characters plus space. Note that fstat gives us the filetype anded into the high bits</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>100</span><span class='dot2 op'>..</span><span class='integer val'>106</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'000'</span> <span class='plus op'>+</span> <span class='fstat identifier id'>fstat</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='float val'>3</span><span class='dot2 op'>..</span><span class='integer val'>5</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='string val'>' '</span>

  <span class='comment val'># mtime of file - epoch time format, in octal, followed by a space</span>

  <span class='octal_mtime identifier id'>octal_mtime</span> <span class='assign token'>=</span> <span class='fstat identifier id'>fstat</span><span class='dot token'>.</span><span class='mtime identifier id'>mtime</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='rparen token'>)</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>136</span><span class='dot2 op'>..</span><span class='integer val'>147</span><span class='rbrack token'>]</span> <span class='assign token'>=</span>  <span class='octal_mtime identifier id'>octal_mtime</span> <span class='plus op'>+</span>  <span class='lparen token'>(</span><span class='string val'>' '</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='integer val'>12</span> <span class='minus op'>-</span> <span class='octal_mtime identifier id'>octal_mtime</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='comment val'># size of file - we only use the short file size encoding - 11 octal characters, left padded with zeros, followed by a space</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>124</span><span class='dot2 op'>..</span><span class='integer val'>135</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='to_octal identifier id'>to_octal</span><span class='lparen token'>(</span><span class='fstat identifier id'>fstat</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span> <span class='integer val'>11</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>' '</span>

  <span class='comment val'># now that all of the header is setup, we can compute the checksum:</span>

  <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='string val'>'0'</span> <span class='plus op'>+</span> <span class='to_octal identifier id'>to_octal</span><span class='lparen token'>(</span><span class='header_checksum identifier id'>header_checksum</span><span class='lparen token'>(</span><span class='buff identifier id'>buff</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>148</span><span class='dot2 op'>..</span><span class='lparen token'>(</span><span class='integer val'>148</span> <span class='plus op'>+</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='str identifier id'>str</span>

  <span class='return return kw'>return</span> <span class='buff identifier id'>buff</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="standard_header-instance_method">
  
    - (<tt>Object</tt>) <strong>standard_header</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Build a boilerplate header based on what we know won&#8217;t change: for
us, that&#8217;s plain files on plain filesystems with a global set of
ownership
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 88</span>

<span class='def def kw'>def</span> <span class='standard_header identifier id'>standard_header</span>
  <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='dot token'>.</span><span class='chr identifier id'>chr</span> <span class='mult op'>*</span> <span class='integer val'>512</span>

  <span class='comment val'># uid/gid:  6 octal characters followed by space</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>108</span><span class='dot2 op'>..</span><span class='integer val'>114</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='to_octal identifier id'>to_octal</span><span class='lparen token'>(</span><span class='ownership identifier id'>ownership</span><span class='lbrack token'>[</span><span class='symbol val'>:uid</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='integer val'>6</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>' '</span>
  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>116</span><span class='dot2 op'>..</span><span class='integer val'>122</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='to_octal identifier id'>to_octal</span><span class='lparen token'>(</span><span class='ownership identifier id'>ownership</span><span class='lbrack token'>[</span><span class='symbol val'>:gid</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='integer val'>6</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>' '</span>

  <span class='comment val'># type of file: we only use regular files here, thanks!</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>156</span><span class='dot2 op'>..</span><span class='integer val'>156</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'0'</span>

  <span class='comment val'># magic</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>257</span><span class='dot2 op'>..</span><span class='integer val'>261</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'ustar'</span>

  <span class='comment val'># ustar version</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>263</span><span class='dot2 op'>..</span><span class='integer val'>264</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'00'</span>

  <span class='comment val'># device major and minor numbers</span>

  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>329</span><span class='dot2 op'>..</span><span class='integer val'>335</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='string val'>'000000 '</span>
  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>337</span><span class='dot2 op'>..</span><span class='integer val'>343</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='string val'>'000000 '</span>

  <span class='comment val'># username and group name</span>

  <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='ownership identifier id'>ownership</span><span class='lbrack token'>[</span><span class='symbol val'>:username</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>31</span><span class='rbrack token'>]</span>
  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>265</span><span class='dot2 op'>..</span><span class='lparen token'>(</span><span class='integer val'>265</span> <span class='plus op'>+</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='str identifier id'>str</span>

  <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='ownership identifier id'>ownership</span><span class='lbrack token'>[</span><span class='symbol val'>:groupname</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>31</span><span class='rbrack token'>]</span>
  <span class='buff identifier id'>buff</span><span class='lbrack token'>[</span><span class='float val'>297</span><span class='dot2 op'>..</span><span class='lparen token'>(</span><span class='integer val'>297</span> <span class='plus op'>+</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='str identifier id'>str</span>


  <span class='return return kw'>return</span> <span class='buff identifier id'>buff</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="to_octal-instance_method">
  
    - (<tt>Object</tt>) <strong>to_octal</strong>(int, pad_length = nil)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Format INT as octal string, optionally prefix with leading zeros to fill
out to PAD length. INT may be a string or fixnum.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 70</span>

<span class='def def kw'>def</span> <span class='to_octal identifier id'>to_octal</span> <span class='int identifier id'>int</span><span class='comma token'>,</span> <span class='pad_length identifier id'>pad_length</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='pad_length identifier id'>pad_length</span> <span class='integer val'>? </span><span class='sprintf identifier id'>sprintf</span><span class='lparen token'>(</span><span class='dstring node'>&quot;%0#{pad_length}o&quot;</span><span class='comma token'>,</span> <span class='int identifier id'>int</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='sprintf identifier id'>sprintf</span><span class='lparen token'>(</span><span class='string val'>'%o'</span><span class='comma token'>,</span> <span class='int identifier id'>int</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="write-instance_method">
  
    - (<tt>Object</tt>) <strong>write</strong>(file_path, tar_path = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Write out a tar header for the file found at FILE_PATH, using the TAR_PATH
string as the filename in the tar file.  If TAR_PATH is not supplied,
initialize from FILE_PATH, removing leading slashes.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/xmlresolution/lib/xmlresolution/tar_writer.rb', line 172</span>

<span class='def def kw'>def</span> <span class='write identifier id'>write</span> <span class='file_path identifier id'>file_path</span><span class='comma token'>,</span> <span class='tar_path identifier id'>tar_path</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

  <span class='length identifier id'>length</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

  <span class='tar_path identifier id'>tar_path</span> <span class='assign token'>=</span> <span class='file_path identifier id'>file_path</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/^\/+/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='tar_path identifier id'>tar_path</span>

  <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='make_header identifier id'>make_header</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='comma token'>,</span> <span class='tar_path identifier id'>tar_path</span><span class='rparen token'>)</span>
  <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='comma token'>,</span> <span class='string val'>'r'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='file identifier id'>file</span><span class='bitor op'>|</span>
    <span class='while while kw'>while</span> <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>512</span><span class='rparen token'>)</span>
      <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='buff identifier id'>buff</span>
      <span class='length identifier id'>length</span> <span class='assign token'>=</span> <span class='buff identifier id'>buff</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='integer val'>0</span><span class='dot token'>.</span><span class='chr identifier id'>chr</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='integer val'>512</span> <span class='minus op'>-</span> <span class='length identifier id'>length</span><span class='rparen token'>)</span>   <span class='comment val'># pad with nul characters to 512 bytes, if necessary.</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Mar 15 15:44:16 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.0 (ruby-1.8.7).
</div>

  </body>
</html>